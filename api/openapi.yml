openapi: 3.0.3
info:
  title: "MassBank3 API"
  version: "3.0"
# servers:
#   - url: "http://localhost:8081"
paths:
  /records:
    parameters:
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Contributor"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InstrumentType"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/MsType"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/IonMode"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Splash"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/CompoundName"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/CompoundClass"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/ExactMass"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/MassTolerance"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Formula"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Peaks"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Intensity"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/NeutralLoss"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/PeakList"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/PeakListThreshold"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InChI"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InChIKey"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Substructure"
    get:
      summary: Get all records.
      operationId: getRecords
      responses:
        "200":
          description: "A list of records."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "./schemas/MBRecord.yaml"
  /records/search:
    parameters:
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Contributor"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InstrumentType"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/MsType"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/IonMode"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Splash"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/CompoundName"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/CompoundClass"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/ExactMass"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/MassTolerance"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Formula"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Peaks"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Intensity"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/NeutralLoss"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/PeakList"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/PeakListThreshold"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InChI"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/InChIKey"
      - $ref: "./schemas/FilterParams.yaml#/components/parameters/Substructure"
    get:
      summary: Get a list of records as a search result in a specific format (accession, similarity score)
      operationId: getSearchResults
      responses:
        "200":
          description: "A list of search results."
          content:
            application/json:
              schema:
                $ref: "./schemas/SearchResult.yaml"

  /records/{accession}:
    parameters:
      - name: accession
        in: path
        description: The record by accession id.
        required: true
        schema:
          type: string
    get:
      summary: Get a MassBank record
      operationId: getRecord
      responses:
        "200":
          description: "A MassBank record"
          content:
            application/json:
              schema:
                $ref: "./schemas/MBRecord.yaml"
  /records/{accession}/simple:
    parameters:
      - name: accession
        in: path
        description: The accession id of the record
        required: true
        schema:
          type: string
    get:
      summary: Get a MassBank record in simple format (accession, title, peaks, smiles)
      operationId: getSimpleRecord
      responses:
        "200":
          description: "A simple MassBank record (accession, title, peaks, smiles)"
          content:
            application/json:
              schema:
                $ref: "./schemas/MBRecord.yaml"
  /records/count:
    get:
      summary: The number of all records
      operationId: getCount
      responses:
        "200":
          description: "The record count"
          content:
            application/json:
              schema:
                type: string
  /filter/browse:
    get:
      summary: get browse options
      operationId: getBrowseOptions
      parameters:
        - in: query
          name: instrument_type
          description: Filter by a list of instrument type, which will be associated by OR.
          schema:
            $ref: "./schemas/FilterSchemas.yaml#/components/schemas/InstrumentType"
          required: false
        - in: query
          description: Filter by a List of MS types, which are associated by OR. If none is given, all is assumed.
          name: ms_type
          schema:
            $ref: "./schemas/FilterSchemas.yaml#/components/schemas/MSType"
          required: false
        - in: query
          name: ion_mode
          description: Filter by ion mode. If none is given, both is assumed.
          schema:
            $ref: "./schemas/FilterSchemas.yaml#/components/schemas/IonMode"
          required: false
        - in: query
          name: contributor
          description: a contributor (institution)
          schema:
            $ref: "./schemas/FilterSchemas.yaml#/components/schemas/Contributor"
          required: false
      responses:
        "200":
          description: "All browse options"
          content:
            application/json:
              schema:
                $ref: "./schemas/FilterOptions.yaml#/components/schemas/BrowseOptions"
  /metadata:
    get:
      summary: get massbank metadata
      operationId: getMetadata
      responses:
        "200":
          description: "Metadata for database and datasets"
          content:
            application/json:
              schema:
                $ref: "./schemas/FilterOptions.yaml#/components/schemas/Metadata"

  /version:
    get:
      summary: get API version
      operationId: getVersion
      responses:
        "200":
          description: "Version for MassBank API with timestamp of build"
          content:
            application/json:
              schema:
                type: string
                example: MassBank API service 0.1, 2025-01-22T14:20:57+01:00

  /status:
    get:
      summary: get API status
      operationId: getStatus
      responses:
        "200":
          description: "Status of the API and attached services"
          content:
            application/json:
              schema:
                type: object
                properties:
                  postgres:
                    description: The status of the postgres database.
                    type: object
                    properties:
                      status:
                        description: The status of the postgres database.
                        type: string
                      error:
                        description: The error message if the postgres database is not running.
                        type: string
                  export_service:
                    description: The status of the export service.
                    type: object
                    properties:
                      status:
                        description: The status of the export service.
                        type: string
                      error:
                        description: The error message if the export service is not running.
                        type: string
                  similarity_service:
                    description: The status of the similarity service.
                    type: object
                    properties:
                      status:
                        description: The status of the similarity service.
                        type: string
                      error:
                        description: The error message if the similarity service is not running.
                        type: string

  /similarity:
    parameters:
      - in: query
        name: peak_list
        description: Filter by peak list.
        schema:
          $ref: "./schemas/FilterSchemas.yaml#/components/schemas/PeakList"
        required: true
      - in: query
        name: reference_spectra_list
        description: Filter by reference spectra list.
        schema:
          type: array
          items:
            type: string
          example:
            - MSBNK-IPB_Halle-PB001341
            - MSBNK-IPB_Halle-PB006202
            - MSBNK-IPB_Halle-PB006203
            - MSBNK-IPB_Halle-PB001342
            - MSBNK-IPB_Halle-PB001343
        required: false
      - in: query
        name: limit
        description: "Maximum number of results."
        schema:
          $ref: "./schemas/FilterSchemas.yaml#/components/schemas/Limit"
        required: false
      - in: query
        name: threshold
        description: Threshold as minimal score.
        schema:
          $ref: "./schemas/FilterSchemas.yaml#/components/schemas/PeakListThreshold"
        required: false
    get:
      summary: Get a list of records with similarity scores
      operationId: getSimilarity
      responses:
        "200":
          description: "A list of similar records"
          content:
            application/json:
              schema:
                $ref: "./schemas/SimilaritySearchResult.yaml"
